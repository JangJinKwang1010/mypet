<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="mapper.diary">

	<insert id="free_upload" parameterType="com.mypet.vo.DiaryVO">
		insert into mypet_free_diary values ('f'||free_seq.nextval, #{id}, #{ftitle}, sysdate, #{fcontent}, 0, 0, 0 )
	</insert>
	
	<select id="free_list" parameterType="map" resultType="com.mypet.vo.DiaryVO">
		select  rno, fid, id, ftitle, fcontent, fdate, fhit, fheart, fnheart
		 from (select rownum rno, fid, id, ftitle, fcontent, fdate, fhit, fheart, fnheart
		 from (select rno, fid, id, ftitle, fcontent, fdate, fhit, fheart, fnheart from (
		select  rno, fid, id, ftitle, fcontent, to_char(fdate, 'yyyy-mm-dd') fdate, fhit, fheart, fnheart
             from(select  rownum rno, fid, id, ftitle, fcontent, fdate, fhit, fheart, fnheart
				     from(select * from mypet_free_diary order by fdate desc))	where rno between #{start} and #{end}) order by fid)) order by rno desc
	</select>
	
	<select id="target" parameterType="java.lang.Integer" resultType="java.lang.Integer">
		select count(num) from(select rownum num from mypet_free_diary) where num >= #{pageNumber}
	</select>
	
	<select id="free_contents" parameterType="java.lang.String" resultType="com.mypet.vo.DiaryVO">
		select * from mypet_free_diary where fid=#{fid}
	</select>
	
	<update id="free_hit" parameterType="java.lang.String" >
		update mypet_free_diary set fhit=fhit+1 where fid=#{fid}
	</update>
	
	<insert id="free_up_heart" parameterType="com.mypet.vo.DiaryVO">
		insert into mypet_diary_heart values (#{id}, #{fid}, 'up')
	</insert>
	
	<select id="free_up_list" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(*) from mypet_diary_heart where fid=#{fid} and htype='up'
	</select>
	
	<update id="free_up_update" parameterType="java.lang.String">
		update mypet_free_diary set fheart = fheart+1 where fid = #{fid}
	</update>
	
	<select id="free_up_info" parameterType="com.mypet.vo.DiaryVO" resultType="java.lang.Integer">
		select count(*) from mypet_diary_heart where id=#{id} and fid=#{fid} and htype='up'
	</select>
	
	<delete id="free_down_heart" parameterType="com.mypet.vo.DiaryVO">
		delete from mypet_diary_heart where id=#{id} and fid=#{fid} and htype='up'
	</delete>
	
	<update id="free_down_update" parameterType="java.lang.String">
		update mypet_free_diary set fheart = fheart - 1 where fid = #{fid}
	</update>
	
	<insert id="free_up_nheart" parameterType="com.mypet.vo.DiaryVO">
		insert into mypet_diary_heart values (#{id}, #{fid}, 'down')
	</insert>
	
	<select id="free_down_info" parameterType="com.mypet.vo.DiaryVO" resultType="java.lang.Integer">
		select count(*) from mypet_diary_heart where id=#{id} and fid=#{fid} and htype='down'
	</select>
	
	<update id="free_nup_update" parameterType="java.lang.String">
		update mypet_free_diary set fnheart = fnheart+1 where fid = #{fid}
	</update>
	
	<update id="free_ndown_update" parameterType="java.lang.String">
		update mypet_free_diary set fnheart = fnheart - 1 where fid = #{fid}
	</update>
	
		<delete id="free_down_nheart" parameterType="com.mypet.vo.DiaryVO">
		delete from mypet_diary_heart where id=#{id} and fid=#{fid} and htype='down'
	</delete>

</mapper>