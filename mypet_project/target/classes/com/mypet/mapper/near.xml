<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="mapper.near">

	<select id="addr_select" parameterType="java.lang.String" resultType="java.lang.String">
		select addr1 from mypet_member where id=#{id}
	</select>
	
	<insert id="near_upload" parameterType="com.mypet.vo.NearVO">
		insert into mypet_near values ('n'||near_seq.nextval, #{pid}, #{id}, #{kind}, #{work}, to_char(sysdate,'yyyy-mm-dd hh24:mi:ss'), #{enddate}, #{title}, #{content}, 0)		
	</insert>
	
	<select id="nid_select" resultType="java.lang.String">
		select nid from (select nid from mypet_near order by startdate desc) where rownum=1
	</select>
	
	<insert id="map_upload" parameterType="com.mypet.vo.NearVO">
		insert into mypet_map values(#{id}, #{nid}, #{pid}, #{addr}, #{category})
	</insert>
	
	<select id="near_list" resultType="com.mypet.vo.NearVO">
		select * from mypet_near order by startdate desc
	</select>
	
	<select id="addr_list" resultType="com.mypet.vo.NearVO">
		select distinct(addr) from mypet_map group by addr
	</select>
	
	<select id="map_list" resultType="com.mypet.vo.NearVO">
		select m.* from mypet_map m, mypet_near n <![CDATA[ where m.nid = n.nid and sysdate - to_date(n.enddate, 'yyyy-mm-dd')  <  0 and addr = #{addr} ]]>
	</select>
	
	<select id="near_content" parameterType="java.lang.String" resultType="com.mypet.vo.NearVO">
		select * from mypet_near where nid=#{nid}
	</select>
	
	<update id="hit" parameterType="java.lang.String">
		update mypet_near set hit=hit+1 where nid=#{nid}
	</update>
	
	<delete id="near_delete" parameterType="java.lang.String" >
		delete from mypet_near where nid=#{nid}
	</delete>
	
	<delete id="map_delete" parameterType="java.lang.String">
		delete from mypet_map where nid=#{nid}
	</delete>
	
	<insert id="near_heart_upload" parameterType="com.mypet.vo.NearVO">
		insert into mypet_heart values (#{id}, #{nid})
	</insert>
	
	<select id="near_heart_result" parameterType="com.mypet.vo.NearVO" resultType="java.lang.Integer">
		select count(*) from mypet_heart where id=#{id} and nid=#{nid}
	</select>
	
	<delete id="near_heart_delete" parameterType="com.mypet.vo.NearVO">
		delete from mypet_heart where id=#{id} and nid=#{nid}
	</delete>
	
	<select id="near_heart_count" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(*) from mypet_heart where nid=#{nid}
	</select>
	
	<update id="near_update_upload" parameterType="com.mypet.vo.NearVO">
		update mypet_near set kind=#{kind}, work=#{work}, enddate=#{enddate}, title=#{title}, content=#{content} where nid=#{nid} 
	</update>
	
	<update id="map_update_upload" parameterType="com.mypet.vo.NearVO">
		update mypet_map set category=#{category} where nid=#{nid}
	</update>
	
	<select id="near_pet" parameterType="java.lang.String" resultType="java.lang.String">
		select category from mypet_pet where pid=#{pid}
	</select>	
	
	<update id="near_end" parameterType="java.lang.String">
		update mypet_near set enddate = to_char(sysdate - 1, 'yyyy-mm-dd') where nid=#{nid}
	</update>

</mapper>